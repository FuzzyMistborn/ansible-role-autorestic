---
kind: pipeline
type: docker
name: Autorestic Role Checks

steps:
  - name: ansible-lint + yamllint
    image: fuzzymistborn/docker-linting:latest
    environment:
    commands:
      - "ansible-lint ."
      - "yamllint ."

  - name: Send TG Notification
    image: appleboy/drone-telegram
    settings:
      token:
        from_secret: tg_token
      to:
        from_secret: tg_id
      format: markdown
      message: >
        {{#success build.status}}
        âœ…  Build for `{{repo.name}}` was *successful*!


        ğŸ“  Commit - {{ commit.message }}


        ğŸŒ  [Output]({{build.link}})
        {{else}}
        âŒ  Build for `{{repo.name}}` has *FAILED*!


        ğŸ“  Commit - {{ commit.message }}


        ğŸŒ  [Output]({{build.link}})
        {{/success}}
    when:
      status: [ success, failure ]
